"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Bootstrap = void 0;

var _camelcase = _interopRequireDefault(require("camelcase"));

var _fs = _interopRequireDefault(require("fs"));

var _handlebars = _interopRequireDefault(require("handlebars"));

var _path = _interopRequireDefault(require("path"));

var _slugify = _interopRequireDefault(require("slugify"));

var _prompts = _interopRequireDefault(require("prompts"));

var _getProjectAndServerConfig = require("../config/getProjectAndServerConfig");

var _ops = require("../dev-utils/ops");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

class InitResolve {
  constructor(configured, serverConfigContext, projectConfigContext, deps) {
    _defineProperty(this, "configured", void 0);

    _defineProperty(this, "projectConfigContext", void 0);

    _defineProperty(this, "serverConfigContext", void 0);

    _defineProperty(this, "deps", void 0);

    this.configured = configured;
    this.projectConfigContext = projectConfigContext;
    this.serverConfigContext = serverConfigContext;
    this.deps = deps;
  }

}

class Bootstrap {
  constructor(cwd, version) {
    _defineProperty(this, "cwd", void 0);

    _defineProperty(this, "projectConfigPath", void 0);

    _defineProperty(this, "serverConfigPath", void 0);

    _defineProperty(this, "packageJsonPath", void 0);

    _defineProperty(this, "pkg", void 0);

    _defineProperty(this, "version", void 0);

    this.cwd = cwd;
    this.version = version;
    this.projectConfigPath = _path.default.resolve(this.cwd, 'wpackio.project.js');
    this.serverConfigPath = _path.default.resolve(this.cwd, 'wpackio.server.js');
    this.packageJsonPath = _path.default.resolve(this.cwd, './package.json');

    try {
      // eslint-disable-next-line global-require, @typescript-eslint/no-var-requires
      const pkg = require(this.packageJsonPath);

      this.pkg = pkg;
    } catch (e) {
      this.pkg = {
        name: '',
        homepage: '',
        author: '',
        license: 'UNLICENSED'
      };
    }
  }

  async bootstrap() {
    if (this.isConfigPresent('project')) {
      const config = (0, _getProjectAndServerConfig.getProjectConfig)(this.cwd).projectConfig;
      const projectContext = {
        appName: config.appName,
        author: '',
        hasFlow: config.hasFlow ? 'true' : 'false',
        hasLess: config.hasLess ? 'true' : 'false',
        hasReact: config.hasReact ? 'true' : 'false',
        hasSass: config.hasSass ? 'true' : 'false',
        hasTS: (0, _ops.hasTypeScript)(this.cwd)[0] ? 'true' : 'false',
        license: '',
        outputPath: config.outputPath,
        slug: config.slug,
        type: config.type,
        watch: ''
      };
      const deps = this.getDependencies(projectContext); // If project config is present, then just configure the server

      if (this.isConfigPresent('server')) {
        // since server config is present, we make a dep type resolver
        return Promise.resolve(new InitResolve('deps', undefined, undefined, deps));
      } // Configure the server


      const serverContext = await this.initServerConfig();
      return Promise.resolve(new InitResolve('server', serverContext, projectContext, deps));
    } // When project config is not present, we don't care about other stuff
    // We will override them. So call everything


    const projectContext = await this.initProjectConfig();
    const serverContext = await this.initServerConfig();
    const deps = this.configureScripts(projectContext);
    this.initSharedConfigFiles();
    return Promise.resolve(new InitResolve('project', serverContext, projectContext, deps));
  }

  async getUserInput() {
    // 'plugin', 'theme'
    const isTheme = this.fileExists(_path.default.resolve(this.cwd, './style.css'));
    const questions = [// Ask type (if style.css present, then theme)
    {
      message: 'Type of WordPress Project (plugin or theme)',
      name: 'type',
      type: 'select',
      choices: [{
        title: 'Plugin',
        value: 'plugin'
      }, {
        title: 'Theme',
        value: 'theme'
      }],
      initial: isTheme ? 1 : 0,
      hint: isTheme ? 'We think yours is a THEME' : 'We think yours is a PLUGIN'
    }, // Ask appName (auto-generate from package.json)
    {
      message: prev => {
        return `Name of WordPress ${prev} (camelCase)`;
      },
      name: 'appName',
      type: 'text',
      initial: (0, _camelcase.default)(this.pkg.name) || '',
      format: val => (0, _camelcase.default)(val)
    }, // Ask slug (default, directory name)
    {
      message: answers => `Slug (directory name) of your ${answers.type} (alphanumeric & dash)`,
      name: 'slug',
      type: 'text',
      initial: (0, _slugify.default)(_path.default.basename(this.cwd)),
      format: val => (0, _slugify.default)(val)
    }, // Ask outputPath (relative), defaults 'dist'
    {
      message: 'Output path (relative) of compiled files',
      name: 'outputPath',
      type: 'text',
      initial: 'dist'
    }, // Ask if react, sass, flow needed.
    {
      message: 'Check all the features/support you need',
      name: 'features',
      type: 'multiselect',
      choices: [{
        title: 'React',
        value: 'hasReact',
        selected: true
      }, {
        title: 'Flowtype',
        value: 'hasFlow'
      }, {
        title: 'Typescript',
        value: 'hasTS'
      }, {
        title: 'Sass/Scss',
        value: 'hasSass'
      }, {
        title: 'Less',
        value: 'hasLess',
        selected: true
      }],
      hint: '- Space to select. âŽ Return to submit'
    }, // Ask glob pattern for .php files.
    {
      message: 'Glob pattern for watching PHP files for changes',
      name: 'watch',
      type: 'text',
      initial: './inc|includes/**/*.php'
    }];
    return (0, _prompts.default)(questions);
  }
  /**
   * Create project config file and return user provided context.
   */


  async initProjectConfig() {
    // Return the resolved prompts for further processing
    return this.getUserInput().then(answers => {
      let author = '';

      if (typeof this.pkg.author === 'string') {
        // eslint-disable-next-line prefer-destructuring
        author = this.pkg.author;
      } else if (typeof this.pkg.author === 'object') {
        author = `${this.pkg.author.name} (${this.pkg.author.email}) <${this.pkg.author.url}>`;
      }

      const context = {
        appName: answers.appName,
        type: answers.type,
        slug: answers.slug,
        author,
        license: this.pkg.license || 'UNLICENSED',
        outputPath: answers.outputPath,
        hasReact: answers.features.indexOf('hasReact') !== -1 ? 'true' : 'false',
        hasFlow: answers.features.indexOf('hasFlow') !== -1 ? 'true' : 'false',
        hasTS: answers.features.indexOf('hasTS') !== -1 ? 'true' : 'false',
        hasSass: answers.features.indexOf('hasSass') !== -1 ? 'true' : 'false',
        hasLess: answers.features.indexOf('hasLess') !== -1 ? 'true' : 'false',
        watch: answers.watch
      };

      const source = _fs.default.readFileSync(_path.default.resolve(__dirname, '../../templates/wpackio.project.js.hbs')).toString();

      const compiler = _handlebars.default.compile(source);

      _fs.default.writeFileSync(this.projectConfigPath, compiler(context));

      return context;
    });
  }
  /**
   * Create server config file and return user provided context.
   */


  async initServerConfig() {
    // 1. Ask proxy URL.
    const questions = [{
      name: 'proxy',
      message: 'URL (with http://) of local development server',
      type: 'text',
      initial: 'http://localhost:8080'
    }];
    return (0, _prompts.default)(questions).then(answers => {
      const context = {
        proxy: answers.proxy
      };

      const source = _fs.default.readFileSync(_path.default.resolve(__dirname, '../../templates/wpackio.server.js.hbs')).toString();

      const compiler = _handlebars.default.compile(source);

      _fs.default.writeFileSync(this.serverConfigPath, compiler(context));

      return context;
    });
  }
  /**
   * Create a default production ready (90%+ global coverage)
   * browserlistrc file for your project and a postcss.config.js
   * file.
   */


  initSharedConfigFiles() {
    _fs.default.writeFileSync(_path.default.resolve(this.cwd, '.browserslistrc'), '> 0.25%, not dead');

    _fs.default.writeFileSync(_path.default.resolve(this.cwd, 'postcss.config.js'), `/* eslint-disable global-require, import/no-extraneous-dependencies */
module.exports = {
	// You can add more plugins and other postcss config
	// For more info see
	// <https://github.com/postcss/postcss-loader#configuration>
	// There is no need to use cssnano, webpack takes care of it!
	plugins: [require('autoprefixer')],
};
`);
  }
  /**
   * Configure package.json file and figure which dependencies to install.
   */


  configureScripts(projectContext) {
    const packageFileData = this.fileExists(this.packageJsonPath) ? // eslint-disable-next-line global-require
    require(this.packageJsonPath) : {
      name: projectContext.appName
    }; // Check if script is already present

    const scripts = {
      build: 'wpackio-scripts build',
      start: 'wpackio-scripts start',
      bootstrap: 'wpackio-scripts bootstrap',
      archive: 'wpackio-scripts pack'
    };

    if (!packageFileData.scripts) {
      packageFileData.scripts = {};
    }

    Object.keys(scripts).forEach(script => {
      // Take a backup if the script is already defined
      // and doesn't equal to what we would like it to have.
      if (packageFileData.scripts && packageFileData.scripts[script] != null && packageFileData.scripts[script] !== scripts[script]) {
        packageFileData.scripts[`${script}-backup`] = packageFileData.scripts[script];
        packageFileData.scripts[script] = scripts[script];
      } else if (packageFileData.scripts) {
        // Otherwise define our own
        packageFileData.scripts[script] = scripts[script];
      }
    }); // Write it

    _fs.default.writeFileSync(this.packageJsonPath, JSON.stringify(packageFileData, null, 2)); // Return dependencies


    return this.getDependencies(projectContext);
  }

  getDependencies(projectContext) {
    const packageFileData = this.fileExists(this.packageJsonPath) ? // eslint-disable-next-line global-require
    require(this.packageJsonPath) : {
      name: projectContext.appName
    }; // Add dependencies of @wpackio/entrypoint and @wpackio/scripts if needed

    const dependencies = ['@wpackio/entrypoint'];
    const devDependencies = []; // If @wpackio/scripts is not already present in devDependencies
    // Then push it. We do this check, because @wpackio/cli might already
    // have installed it during scaffolding.

    if (!packageFileData.devDependencies || !packageFileData.devDependencies['@wpackio/scripts']) {
      devDependencies.push('@wpackio/scripts');
    } // If has Sass, then push sass (dart sass)


    if (projectContext.hasSass === 'true') {
      devDependencies.push('sass');
    } // if has Less, then push less


    if (projectContext.hasLess === 'true') {
      devDependencies.push('less');
    } // if has ts, then push fork-ts-checker-webpack-plugin


    if (projectContext.hasTS === 'true') {
      devDependencies.push('typescript');
      devDependencies.push('fork-ts-checker-webpack-plugin');
    } // always push postcss, starting version 6.0


    devDependencies.push('postcss');
    return {
      dependencies,
      devDependencies
    };
  }

  isConfigPresent(type) {
    const filePath = type === 'project' ? this.projectConfigPath : this.serverConfigPath;
    return this.fileExists(filePath);
  }

  fileExists(filePath) {
    try {
      return _fs.default.statSync(filePath).isFile();
    } catch (e) {
      if (e.code === 'ENOENT') {
        return false;
      }

      throw e;
    }
  }

}

exports.Bootstrap = Bootstrap;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zY3JpcHRzL0Jvb3RzdHJhcC50cyJdLCJuYW1lcyI6WyJJbml0UmVzb2x2ZSIsImNvbnN0cnVjdG9yIiwiY29uZmlndXJlZCIsInNlcnZlckNvbmZpZ0NvbnRleHQiLCJwcm9qZWN0Q29uZmlnQ29udGV4dCIsImRlcHMiLCJCb290c3RyYXAiLCJjd2QiLCJ2ZXJzaW9uIiwicHJvamVjdENvbmZpZ1BhdGgiLCJwYXRoIiwicmVzb2x2ZSIsInNlcnZlckNvbmZpZ1BhdGgiLCJwYWNrYWdlSnNvblBhdGgiLCJwa2ciLCJyZXF1aXJlIiwiZSIsIm5hbWUiLCJob21lcGFnZSIsImF1dGhvciIsImxpY2Vuc2UiLCJib290c3RyYXAiLCJpc0NvbmZpZ1ByZXNlbnQiLCJjb25maWciLCJwcm9qZWN0Q29uZmlnIiwicHJvamVjdENvbnRleHQiLCJhcHBOYW1lIiwiaGFzRmxvdyIsImhhc0xlc3MiLCJoYXNSZWFjdCIsImhhc1Nhc3MiLCJoYXNUUyIsIm91dHB1dFBhdGgiLCJzbHVnIiwidHlwZSIsIndhdGNoIiwiZ2V0RGVwZW5kZW5jaWVzIiwiUHJvbWlzZSIsInVuZGVmaW5lZCIsInNlcnZlckNvbnRleHQiLCJpbml0U2VydmVyQ29uZmlnIiwiaW5pdFByb2plY3RDb25maWciLCJjb25maWd1cmVTY3JpcHRzIiwiaW5pdFNoYXJlZENvbmZpZ0ZpbGVzIiwiZ2V0VXNlcklucHV0IiwiaXNUaGVtZSIsImZpbGVFeGlzdHMiLCJxdWVzdGlvbnMiLCJtZXNzYWdlIiwiY2hvaWNlcyIsInRpdGxlIiwidmFsdWUiLCJpbml0aWFsIiwiaGludCIsInByZXYiLCJmb3JtYXQiLCJ2YWwiLCJhbnN3ZXJzIiwiYmFzZW5hbWUiLCJzZWxlY3RlZCIsInRoZW4iLCJlbWFpbCIsInVybCIsImNvbnRleHQiLCJmZWF0dXJlcyIsImluZGV4T2YiLCJzb3VyY2UiLCJmcyIsInJlYWRGaWxlU3luYyIsIl9fZGlybmFtZSIsInRvU3RyaW5nIiwiY29tcGlsZXIiLCJoYW5kbGViYXJzIiwiY29tcGlsZSIsIndyaXRlRmlsZVN5bmMiLCJwcm94eSIsInBhY2thZ2VGaWxlRGF0YSIsInNjcmlwdHMiLCJidWlsZCIsInN0YXJ0IiwiYXJjaGl2ZSIsIk9iamVjdCIsImtleXMiLCJmb3JFYWNoIiwic2NyaXB0IiwiSlNPTiIsInN0cmluZ2lmeSIsImRlcGVuZGVuY2llcyIsImRldkRlcGVuZGVuY2llcyIsInB1c2giLCJmaWxlUGF0aCIsInN0YXRTeW5jIiwiaXNGaWxlIiwiY29kZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7QUEwQ0EsTUFBTUEsV0FBTixDQUFrQjtBQVNqQkMsRUFBQUEsV0FBVyxDQUNWQyxVQURVLEVBRVZDLG1CQUZVLEVBR1ZDLG9CQUhVLEVBSVZDLElBSlUsRUFLVDtBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUNELFNBQUtILFVBQUwsR0FBa0JBLFVBQWxCO0FBQ0EsU0FBS0Usb0JBQUwsR0FBNEJBLG9CQUE1QjtBQUNBLFNBQUtELG1CQUFMLEdBQTJCQSxtQkFBM0I7QUFDQSxTQUFLRSxJQUFMLEdBQVlBLElBQVo7QUFDQTs7QUFuQmdCOztBQXNCWCxNQUFNQyxTQUFOLENBQWdCO0FBYXRCTCxFQUFBQSxXQUFXLENBQUNNLEdBQUQsRUFBY0MsT0FBZCxFQUErQjtBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUN6QyxTQUFLRCxHQUFMLEdBQVdBLEdBQVg7QUFDQSxTQUFLQyxPQUFMLEdBQWVBLE9BQWY7QUFDQSxTQUFLQyxpQkFBTCxHQUF5QkMsY0FBS0MsT0FBTCxDQUFhLEtBQUtKLEdBQWxCLEVBQXVCLG9CQUF2QixDQUF6QjtBQUNBLFNBQUtLLGdCQUFMLEdBQXdCRixjQUFLQyxPQUFMLENBQWEsS0FBS0osR0FBbEIsRUFBdUIsbUJBQXZCLENBQXhCO0FBQ0EsU0FBS00sZUFBTCxHQUF1QkgsY0FBS0MsT0FBTCxDQUFhLEtBQUtKLEdBQWxC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QUFFT2xFLEVBQUFBLGVBQWUsQ0FBQ1ksSUFBRCxFQUFzQztBQUM1RCxVQUFNd0QsUUFBUSxHQUNieEQsSUFBSSxLQUFLLFNBQVQsR0FBcUIsS0FBS3pCLGlCQUExQixHQUE4QyxLQUFLRyxnQkFEcEQ7QUFFQSxXQUFPLEtBQUtrQyxVQUFMLENBQWdCNEMsUUFBaEIsQ0FBUDtBQUNBOztBQUVPNUMsRUFBQUEsVUFBVSxDQUFDNEMsUUFBRCxFQUE0QjtBQUM3QyxRQUFJO0FBQ0gsYUFBT3ZCLFlBQUd3QixRQUFILENBQVlELFFBQVosRUFBc0JFLE1BQXRCLEVBQVA7QUFDQSxLQUZELENBRUUsT0FBTzVFLENBQVAsRUFBVTtBQUNYLFVBQUlBLENBQUMsQ0FBQzZFLElBQUYsS0FBVyxRQUFmLEVBQXlCO0FBQ3hCLGVBQU8sS0FBUDtBQUNBOztBQUNELFlBQU03RSxDQUFOO0FBQ0E7QUFDRDs7QUFsV3FCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNhbWVsQ2FzZSBmcm9tICdjYW1lbGNhc2UnO1xuaW1wb3J0IGZzIGZyb20gJ2ZzJztcbmltcG9ydCBoYW5kbGViYXJzIGZyb20gJ2hhbmRsZWJhcnMnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgc2x1Z2lmeSBmcm9tICdzbHVnaWZ5JztcbmltcG9ydCBwcm9tcHRzIGZyb20gJ3Byb21wdHMnO1xuaW1wb3J0IHsgZ2V0UHJvamVjdENvbmZpZyB9IGZyb20gJy4uL2NvbmZpZy9nZXRQcm9qZWN0QW5kU2VydmVyQ29uZmlnJztcbmltcG9ydCB7IGhhc1R5cGVTY3JpcHQgfSBmcm9tICcuLi9kZXYtdXRpbHMvb3BzJztcblxuaW50ZXJmYWNlIFBrZyB7XG5cdG5hbWU6IHN0cmluZztcblx0aG9tZXBhZ2U/OiBzdHJpbmc7XG5cdGF1dGhvcj86IHN0cmluZyB8IHsgbmFtZTogc3RyaW5nOyBlbWFpbDogc3RyaW5nOyB1cmw6IHN0cmluZyB9O1xuXHRsaWNlbnNlPzogc3RyaW5nO1xuXHRzY3JpcHRzPzoge1xuXHRcdFt4OiBzdHJpbmddOiBzdHJpbmc7XG5cdH07XG5cdGRlcGVuZGVuY2llcz86IHtcblx0XHRbeDogc3RyaW5nXTogc3RyaW5nO1xuXHR9O1xuXHRkZXZEZXBlbmRlbmNpZXM/OiB7XG5cdFx0W3g6IHN0cmluZ106IHN0cmluZztcblx0fTtcbn1cblxuaW50ZXJmYWNlIFByb2plY3RDb25maWdDb250ZXh0IHtcblx0YXBwTmFtZTogc3RyaW5nO1xuXHR0eXBlOiBzdHJpbmc7XG5cdHNsdWc6IHN0cmluZztcblx0YXV0aG9yOiBzdHJpbmc7XG5cdGxpY2Vuc2U6IHN0cmluZztcblx0b3V0cHV0UGF0aDogc3RyaW5nO1xuXHRoYXNSZWFjdDogJ3RydWUnIHwgJ2ZhbHNlJztcblx0aGFzRmxvdzogJ3RydWUnIHwgJ2ZhbHNlJztcblx0aGFzVFM6ICd0cnVlJyB8ICdmYWxzZSc7XG5cdGhhc1Nhc3M6ICd0cnVlJyB8ICdmYWxzZSc7XG5cdGhhc0xlc3M6ICd0cnVlJyB8ICdmYWxzZSc7XG5cdHdhdGNoOiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBTZXJ2ZXJDb25maWdDb250ZXh0IHtcblx0cHJveHk6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQcm9qZWN0RGVwZW5kZW5jaWVzIHtcblx0ZGVwZW5kZW5jaWVzOiBzdHJpbmdbXTtcblx0ZGV2RGVwZW5kZW5jaWVzOiBzdHJpbmdbXTtcbn1cblxuY2xhc3MgSW5pdFJlc29sdmUge1xuXHRwdWJsaWMgY29uZmlndXJlZDogJ3Byb2plY3QnIHwgJ3NlcnZlcicgfCAnZGVwcyc7XG5cblx0cHVibGljIHByb2plY3RDb25maWdDb250ZXh0PzogUHJvamVjdENvbmZpZ0NvbnRleHQ7XG5cblx0cHVibGljIHNlcnZlckNvbmZpZ0NvbnRleHQ/OiBTZXJ2ZXJDb25maWdDb250ZXh0O1xuXG5cdHB1YmxpYyBkZXBzPzogUHJvamVjdERlcGVuZGVuY2llcztcblxuXHRjb25zdHJ1Y3Rvcihcblx0XHRjb25maWd1cmVkOiAncHJvamVjdCcgfCAnc2VydmVyJyB8ICdkZXBzJyxcblx0XHRzZXJ2ZXJDb25maWdDb250ZXh0PzogU2VydmVyQ29uZmlnQ29udGV4dCxcblx0XHRwcm9qZWN0Q29uZmlnQ29udGV4dD86IFByb2plY3RDb25maWdDb250ZXh0LFxuXHRcdGRlcHM/OiBQcm9qZWN0RGVwZW5kZW5jaWVzXG5cdCkge1xuXHRcdHRoaXMuY29uZmlndXJlZCA9IGNvbmZpZ3VyZWQ7XG5cdFx0dGhpcy5wcm9qZWN0Q29uZmlnQ29udGV4dCA9IHByb2plY3RDb25maWdDb250ZXh0O1xuXHRcdHRoaXMuc2VydmVyQ29uZmlnQ29udGV4dCA9IHNlcnZlckNvbmZpZ0NvbnRleHQ7XG5cdFx0dGhpcy5kZXBzID0gZGVwcztcblx0fVxufVxuXG5leHBvcnQgY2xhc3MgQm9vdHN0cmFwIHtcblx0cHJpdmF0ZSBjd2Q6IHN0cmluZztcblxuXHRwcml2YXRlIHByb2plY3RDb25maWdQYXRoOiBzdHJpbmc7XG5cblx0cHJpdmF0ZSBzZXJ2ZXJDb25maWdQYXRoOiBzdHJpbmc7XG5cblx0cHJpdmF0ZSBwYWNrYWdlSnNvblBhdGg6IHN0cmluZztcblxuXHRwcml2YXRlIHBrZzogUGtnO1xuXG5cdHByaXZhdGUgdmVyc2lvbjogc3RyaW5nO1xuXG5cdGNvbnN0cnVjdG9yKGN3ZDogc3RyaW5nLCB2ZXJzaW9uOiBzdHJpbmcpIHtcblx0XHR0aGlzLmN3ZCA9IGN3ZDtcblx0XHR0aGlzLnZlcnNpb24gPSB2ZXJzaW9uO1xuXHRcdHRoaXMucHJvamVjdENvbmZpZ1BhdGggPSBwYXRoLnJlc29sdmUodGhpcy5jd2QsICd3cGFja2lvLnByb2plY3QuanMnKTtcblx0XHR0aGlzLnNlcnZlckNvbmZpZ1BhdGggPSBwYXRoLnJlc29sdmUodGhpcy5jd2QsICd3cGFja2lvLnNlcnZlci5qcycpO1xuXHRcdHRoaXMucGFja2FnZUpzb25QYXRoID0gcGF0aC5yZXNvbHZlKHRoaXMuY3dkLCAnLi9wYWNrYWdlLmpzb24nKTtcblx0XHR0cnkge1xuXHRcdFx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGdsb2JhbC1yZXF1aXJlLCBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdmFyLXJlcXVpcmVzXG5cdFx0XHRjb25zdCBwa2cgPSByZXF1aXJlKHRoaXMucGFja2FnZUpzb25QYXRoKSBhcyBQa2c7XG5cdFx0XHR0aGlzLnBrZyA9IHBrZztcblx0XHR9IGNhdGNoIChlKSB7XG5cdFx0XHR0aGlzLnBrZyA9IHtcblx0XHRcdFx0bmFtZTogJycsXG5cdFx0XHRcdGhvbWVwYWdlOiAnJyxcblx0XHRcdFx0YXV0aG9yOiAnJyxcblx0XHRcdFx0bGljZW5zZTogJ1VOTElDRU5TRUQnLFxuXHRcdFx0fTtcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgYm9vdHN0cmFwKCk6IFByb21pc2U8SW5pdFJlc29sdmU+IHtcblx0XHRpZiAodGhpcy5pc0NvbmZpZ1ByZXNlbnQoJ3Byb2plY3QnKSkge1xuXHRcdFx0Y29uc3QgY29uZmlnID0gZ2V0UHJvamVjdENvbmZpZyh0aGlzLmN3ZCkucHJvamVjdENvbmZpZztcblx0XHRcdGNvbnN0IHByb2plY3RDb250ZXh0OiBQcm9qZWN0Q29uZmlnQ29udGV4dCA9IHtcblx0XHRcdFx0YXBwTmFtZTogY29uZmlnLmFwcE5hbWUsXG5cdFx0XHRcdGF1dGhvcjogJycsXG5cdFx0XHRcdGhhc0Zsb3c6IGNvbmZpZy5oYXNGbG93ID8gJ3RydWUnIDogJ2ZhbHNlJyxcblx0XHRcdFx0aGFzTGVzczogY29uZmlnLmhhc0xlc3MgPyAndHJ1ZScgOiAnZmFsc2UnLFxuXHRcdFx0XHRoYXNSZWFjdDogY29uZmlnLmhhc1JlYWN0ID8gJ3RydWUnIDogJ2ZhbHNlJyxcblx0XHRcdFx0aGFzU2FzczogY29uZmlnLmhhc1Nhc3MgPyAndHJ1ZScgOiAnZmFsc2UnLFxuXHRcdFx0XHRoYXNUUzogaGFzVHlwZVNjcmlwdCh0aGlzLmN3ZClbMF0gPyAndHJ1ZScgOiAnZmFsc2UnLFxuXHRcdFx0XHRsaWNlbnNlOiAnJyxcblx0XHRcdFx0b3V0cHV0UGF0aDogY29uZmlnLm91dHB1dFBhdGgsXG5cdFx0XHRcdHNsdWc6IGNvbmZpZy5zbHVnLFxuXHRcdFx0XHR0eXBlOiBjb25maWcudHlwZSxcblx0XHRcdFx0d2F0Y2g6ICcnLFxuXHRcdFx0fTtcblx0XHRcdGNvbnN0IGRlcHMgPSB0aGlzLmdldERlcGVuZGVuY2llcyhwcm9qZWN0Q29udGV4dCk7XG5cdFx0XHQvLyBJZiBwcm9qZWN0IGNvbmZpZyBpcyBwcmVzZW50LCB0aGVuIGp1c3QgY29uZmlndXJlIHRoZSBzZXJ2ZXJcblx0XHRcdGlmICh0aGlzLmlzQ29uZmlnUHJlc2VudCgnc2VydmVyJykpIHtcblx0XHRcdFx0Ly8gc2luY2Ugc2VydmVyIGNvbmZpZyBpcyBwcmVzZW50LCB3ZSBtYWtlIGEgZGVwIHR5cGUgcmVzb2x2ZXJcblx0XHRcdFx0cmV0dXJuIFByb21pc2UucmVzb2x2ZShcblx0XHRcdFx0XHRuZXcgSW5pdFJlc29sdmUoJ2RlcHMnLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgZGVwcylcblx0XHRcdFx0KTtcblx0XHRcdH1cblx0XHRcdC8vIENvbmZpZ3VyZSB0aGUgc2VydmVyXG5cdFx0XHRjb25zdCBzZXJ2ZXJDb250ZXh0ID0gYXdhaXQgdGhpcy5pbml0U2VydmVyQ29uZmlnKCk7XG5cdFx0XHRyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKFxuXHRcdFx0XHRuZXcgSW5pdFJlc29sdmUoJ3NlcnZlcicsIHNlcnZlckNvbnRleHQsIHByb2plY3RDb250ZXh0LCBkZXBzKVxuXHRcdFx0KTtcblx0XHR9XG5cdFx0Ly8gV2hlbiBwcm9qZWN0IGNvbmZpZyBpcyBub3QgcHJlc2VudCwgd2UgZG9uJ3QgY2FyZSBhYm91dCBvdGhlciBzdHVmZlxuXHRcdC8vIFdlIHdpbGwgb3ZlcnJpZGUgdGhlbS4gU28gY2FsbCBldmVyeXRoaW5nXG5cdFx0Y29uc3QgcHJvamVjdENvbnRleHQgPSBhd2FpdCB0aGlzLmluaXRQcm9qZWN0Q29uZmlnKCk7XG5cdFx0Y29uc3Qgc2VydmVyQ29udGV4dCA9IGF3YWl0IHRoaXMuaW5pdFNlcnZlckNvbmZpZygpO1xuXHRcdGNvbnN0IGRlcHMgPSB0aGlzLmNvbmZpZ3VyZVNjcmlwdHMocHJvamVjdENvbnRleHQpO1xuXHRcdHRoaXMuaW5pdFNoYXJlZENvbmZpZ0ZpbGVzKCk7XG5cdFx0cmV0dXJuIFByb21pc2UucmVzb2x2ZShcblx0XHRcdG5ldyBJbml0UmVzb2x2ZSgncHJvamVjdCcsIHNlcnZlckNvbnRleHQsIHByb2plY3RDb250ZXh0LCBkZXBzKVxuXHRcdCk7XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgZ2V0VXNlcklucHV0KCkge1xuXHRcdHR5cGUgcHJvbXB0QW5zd2VyS2V5cyA9XG5cdFx0XHR8ICd0eXBlJ1xuXHRcdFx0fCAnYXBwTmFtZSdcblx0XHRcdHwgJ3NsdWcnXG5cdFx0XHR8ICdvdXRwdXRQYXRoJ1xuXHRcdFx0fCAnZmVhdHVyZXMnXG5cdFx0XHR8ICd3YXRjaCc7XG5cdFx0Ly8gJ3BsdWdpbicsICd0aGVtZSdcblx0XHRjb25zdCBpc1RoZW1lID0gdGhpcy5maWxlRXhpc3RzKHBhdGgucmVzb2x2ZSh0aGlzLmN3ZCwgJy4vc3R5bGUuY3NzJykpO1xuXHRcdGNvbnN0IHF1ZXN0aW9uczogcHJvbXB0cy5Qcm9tcHRPYmplY3Q8cHJvbXB0QW5zd2VyS2V5cz5bXSA9IFtcblx0XHRcdC8vIEFzayB0eXBlIChpZiBzdHlsZS5jc3MgcHJlc2VudCwgdGhlbiB0aGVtZSlcblx0XHRcdHtcblx0XHRcdFx0bWVzc2FnZTogJ1R5cGUgb2YgV29yZFByZXNzIFByb2plY3QgKHBsdWdpbiBvciB0aGVtZSknLFxuXHRcdFx0XHRuYW1lOiAndHlwZScsXG5cdFx0XHRcdHR5cGU6ICdzZWxlY3QnLFxuXHRcdFx0XHRjaG9pY2VzOiBbXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0dGl0bGU6ICdQbHVnaW4nLFxuXHRcdFx0XHRcdFx0dmFsdWU6ICdwbHVnaW4nLFxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0dGl0bGU6ICdUaGVtZScsXG5cdFx0XHRcdFx0XHR2YWx1ZTogJ3RoZW1lJyxcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRdLFxuXHRcdFx0XHRpbml0aWFsOiBpc1RoZW1lID8gMSA6IDAsXG5cdFx0XHRcdGhpbnQ6IGlzVGhlbWVcblx0XHRcdFx0XHQ/ICdXZSB0aGluayB5b3VycyBpcyBhIFRIRU1FJ1xuXHRcdFx0XHRcdDogJ1dlIHRoaW5rIHlvdXJzIGlzIGEgUExVR0lOJyxcblx0XHRcdH0sXG5cdFx0XHQvLyBBc2sgYXBwTmFtZSAoYXV0by1nZW5lcmF0ZSBmcm9tIHBhY2thZ2UuanNvbilcblx0XHRcdHtcblx0XHRcdFx0bWVzc2FnZTogcHJldiA9PiB7XG5cdFx0XHRcdFx0cmV0dXJuIGBOYW1lIG9mIFdvcmRQcmVzcyAke3ByZXZ9IChjYW1lbENhc2UpYDtcblx0XHRcdFx0fSxcblx0XHRcdFx0bmFtZTogJ2FwcE5hbWUnLFxuXHRcdFx0XHR0eXBlOiAndGV4dCcsXG5cdFx0XHRcdGluaXRpYWw6IGNhbWVsQ2FzZSh0aGlzLnBrZy5uYW1lKSB8fCAnJyxcblx0XHRcdFx0Zm9ybWF0OiAodmFsOiBzdHJpbmcpID0+IGNhbWVsQ2FzZSh2YWwpLFxuXHRcdFx0fSxcblx0XHRcdC8vIEFzayBzbHVnIChkZWZhdWx0LCBkaXJlY3RvcnkgbmFtZSlcblx0XHRcdHtcblx0XHRcdFx0bWVzc2FnZTogYW5zd2VycyA9PlxuXHRcdFx0XHRcdGBTbHVnIChkaXJlY3RvcnkgbmFtZSkgb2YgeW91ciAke2Fuc3dlcnMudHlwZX0gKGFscGhhbnVtZXJpYyAmIGRhc2gpYCxcblx0XHRcdFx0bmFtZTogJ3NsdWcnLFxuXHRcdFx0XHR0eXBlOiAndGV4dCcsXG5cdFx0XHRcdGluaXRpYWw6IHNsdWdpZnkocGF0aC5iYXNlbmFtZSh0aGlzLmN3ZCkpLFxuXHRcdFx0XHRmb3JtYXQ6ICh2YWw6IHN0cmluZykgPT4gc2x1Z2lmeSh2YWwpLFxuXHRcdFx0fSxcblx0XHRcdC8vIEFzayBvdXRwdXRQYXRoIChyZWxhdGl2ZSksIGRlZmF1bHRzICdkaXN0J1xuXHRcdFx0e1xuXHRcdFx0XHRtZXNzYWdlOiAnT3V0cHV0IHBhdGggKHJlbGF0aXZlKSBvZiBjb21waWxlZCBmaWxlcycsXG5cdFx0XHRcdG5hbWU6ICdvdXRwdXRQYXRoJyxcblx0XHRcdFx0dHlwZTogJ3RleHQnLFxuXHRcdFx0XHRpbml0aWFsOiAnZGlzdCcsXG5cdFx0XHR9LFxuXHRcdFx0Ly8gQXNrIGlmIHJlYWN0LCBzYXNzLCBmbG93IG5lZWRlZC5cblx0XHRcdHtcblx0XHRcdFx0bWVzc2FnZTogJ0NoZWNrIGFsbCB0aGUgZmVhdHVyZXMvc3VwcG9ydCB5b3UgbmVlZCcsXG5cdFx0XHRcdG5hbWU6ICdmZWF0dXJlcycsXG5cdFx0XHRcdHR5cGU6ICdtdWx0aXNlbGVjdCcsXG5cdFx0XHRcdGNob2ljZXM6IFtcblx0XHRcdFx0XHR7IHRpdGxlOiAnUmVhY3QnLCB2YWx1ZTogJ2hhc1JlYWN0Jywgc2VsZWN0ZWQ6IHRydWUgfSxcblx0XHRcdFx0XHR7IHRpdGxlOiAnRmxvd3R5cGUnLCB2YWx1ZTogJ2hhc0Zsb3cnIH0sXG5cdFx0XHRcdFx0eyB0aXRsZTogJ1R5cGVzY3JpcHQnLCB2YWx1ZTogJ2hhc1RTJyB9LFxuXHRcdFx0XHRcdHsgdGl0bGU6ICdTYXNzL1Njc3MnLCB2YWx1ZTogJ2hhc1Nhc3MnIH0sXG5cdFx0XHRcdFx0eyB0aXRsZTogJ0xlc3MnLCB2YWx1ZTogJ2hhc0xlc3MnLCBzZWxlY3RlZDogdHJ1ZSB9LFxuXHRcdFx0XHRdLFxuXHRcdFx0XHRoaW50OiAnLSBTcGFjZSB0byBzZWxlY3QuIOKPjiBSZXR1cm4gdG8gc3VibWl0Jyxcblx0XHRcdH0sXG5cdFx0XHQvLyBBc2sgZ2xvYiBwYXR0ZXJuIGZvciAucGhwIGZpbGVzLlxuXHRcdFx0e1xuXHRcdFx0XHRtZXNzYWdlOiAnR2xvYiBwYXR0ZXJuIGZvciB3YXRjaGluZyBQSFAgZmlsZXMgZm9yIGNoYW5nZXMnLFxuXHRcdFx0XHRuYW1lOiAnd2F0Y2gnLFxuXHRcdFx0XHR0eXBlOiAndGV4dCcsXG5cdFx0XHRcdGluaXRpYWw6ICcuL2luY3xpbmNsdWRlcy8qKi8qLnBocCcsXG5cdFx0XHR9LFxuXHRcdF07XG5cblx0XHRyZXR1cm4gcHJvbXB0cyhxdWVzdGlvbnMpO1xuXHR9XG5cblx0LyoqXG5cdCAqIENyZWF0ZSBwcm9qZWN0IGNvbmZpZyBmaWxlIGFuZCByZXR1cm4gdXNlciBwcm92aWRlZCBjb250ZXh0LlxuXHQgKi9cblx0cHJpdmF0ZSBhc3luYyBpbml0UHJvamVjdENvbmZpZygpOiBQcm9taXNlPFByb2plY3RDb25maWdDb250ZXh0PiB7XG5cdFx0Ly8gUmV0dXJuIHRoZSByZXNvbHZlZCBwcm9tcHRzIGZvciBmdXJ0aGVyIHByb2Nlc3Npbmdcblx0XHRyZXR1cm4gdGhpcy5nZXRVc2VySW5wdXQoKS50aGVuKGFuc3dlcnMgPT4ge1xuXHRcdFx0bGV0IGF1dGhvciA9ICcnO1xuXHRcdFx0aWYgKHR5cGVvZiB0aGlzLnBrZy5hdXRob3IgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRcdC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmVmZXItZGVzdHJ1Y3R1cmluZ1xuXHRcdFx0XHRhdXRob3IgPSB0aGlzLnBrZy5hdXRob3I7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZiB0aGlzLnBrZy5hdXRob3IgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRcdGF1dGhvciA9IGAke3RoaXMucGtnLmF1dGhvci5uYW1lfSAoJHt0aGlzLnBrZy5hdXRob3IuZW1haWx9KSA8JHt0aGlzLnBrZy5hdXRob3IudXJsfT5gO1xuXHRcdFx0fVxuXHRcdFx0Y29uc3QgY29udGV4dDogUHJvamVjdENvbmZpZ0NvbnRleHQgPSB7XG5cdFx0XHRcdGFwcE5hbWU6IGFuc3dlcnMuYXBwTmFtZSxcblx0XHRcdFx0dHlwZTogYW5zd2Vycy50eXBlLFxuXHRcdFx0XHRzbHVnOiBhbnN3ZXJzLnNsdWcsXG5cdFx0XHRcdGF1dGhvcixcblx0XHRcdFx0bGljZW5zZTogdGhpcy5wa2cubGljZW5zZSB8fCAnVU5MSUNFTlNFRCcsXG5cdFx0XHRcdG91dHB1dFBhdGg6IGFuc3dlcnMub3V0cHV0UGF0aCxcblx0XHRcdFx0aGFzUmVhY3Q6XG5cdFx0XHRcdFx0YW5zd2Vycy5mZWF0dXJlcy5pbmRleE9mKCdoYXNSZWFjdCcpICE9PSAtMSA/ICd0cnVlJyA6ICdmYWxzZScsXG5cdFx0XHRcdGhhc0Zsb3c6IGFuc3dlcnMuZmVhdHVyZXMuaW5kZXhPZignaGFzRmxvdycpICE9PSAtMSA/ICd0cnVlJyA6ICdmYWxzZScsXG5cdFx0XHRcdGhhc1RTOiBhbnN3ZXJzLmZlYXR1cmVzLmluZGV4T2YoJ2hhc1RTJykgIT09IC0xID8gJ3RydWUnIDogJ2ZhbHNlJyxcblx0XHRcdFx0aGFzU2FzczogYW5zd2Vycy5mZWF0dXJlcy5pbmRleE9mKCdoYXNTYXNzJykgIT09IC0xID8gJ3RydWUnIDogJ2ZhbHNlJyxcblx0XHRcdFx0aGFzTGVzczogYW5zd2Vycy5mZWF0dXJlcy5pbmRleE9mKCdoYXNMZXNzJykgIT09IC0xID8gJ3RydWUnIDogJ2ZhbHNlJyxcblx0XHRcdFx0d2F0Y2g6IGFuc3dlcnMud2F0Y2gsXG5cdFx0XHR9O1xuXHRcdFx0Y29uc3Qgc291cmNlOiBzdHJpbmcgPSBmc1xuXHRcdFx0XHQucmVhZEZpbGVTeW5jKFxuXHRcdFx0XHRcdHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuLi8uLi90ZW1wbGF0ZXMvd3BhY2tpby5wcm9qZWN0LmpzLmhicycpXG5cdFx0XHRcdClcblx0XHRcdFx0LnRvU3RyaW5nKCk7XG5cdFx0XHRjb25zdCBjb21waWxlciA9IGhhbmRsZWJhcnMuY29tcGlsZShzb3VyY2UpO1xuXHRcdFx0ZnMud3JpdGVGaWxlU3luYyh0aGlzLnByb2plY3RDb25maWdQYXRoLCBjb21waWxlcihjb250ZXh0KSk7XG5cdFx0XHRyZXR1cm4gY29udGV4dDtcblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDcmVhdGUgc2VydmVyIGNvbmZpZyBmaWxlIGFuZCByZXR1cm4gdXNlciBwcm92aWRlZCBjb250ZXh0LlxuXHQgKi9cblx0cHJpdmF0ZSBhc3luYyBpbml0U2VydmVyQ29uZmlnKCk6IFByb21pc2U8U2VydmVyQ29uZmlnQ29udGV4dD4ge1xuXHRcdHR5cGUgcHJvbXB0QW5zd2VyS2V5cyA9ICdwcm94eSc7XG5cdFx0Ly8gMS4gQXNrIHByb3h5IFVSTC5cblx0XHRjb25zdCBxdWVzdGlvbnM6IHByb21wdHMuUHJvbXB0T2JqZWN0PHByb21wdEFuc3dlcktleXM+W10gPSBbXG5cdFx0XHR7XG5cdFx0XHRcdG5hbWU6ICdwcm94eScsXG5cdFx0XHRcdG1lc3NhZ2U6ICdVUkwgKHdpdGggaHR0cDovLykgb2YgbG9jYWwgZGV2ZWxvcG1lbnQgc2VydmVyJyxcblx0XHRcdFx0dHlwZTogJ3RleHQnLFxuXHRcdFx0XHRpbml0aWFsOiAnaHR0cDovL2xvY2FsaG9zdDo4MDgwJyxcblx0XHRcdH0sXG5cdFx0XTtcblx0XHRyZXR1cm4gcHJvbXB0cyhxdWVzdGlvbnMpLnRoZW4oYW5zd2VycyA9PiB7XG5cdFx0XHRjb25zdCBjb250ZXh0OiBTZXJ2ZXJDb25maWdDb250ZXh0ID0ge1xuXHRcdFx0XHRwcm94eTogYW5zd2Vycy5wcm94eSxcblx0XHRcdH07XG5cdFx0XHRjb25zdCBzb3VyY2U6IHN0cmluZyA9IGZzXG5cdFx0XHRcdC5yZWFkRmlsZVN5bmMoXG5cdFx0XHRcdFx0cGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uLy4uL3RlbXBsYXRlcy93cGFja2lvLnNlcnZlci5qcy5oYnMnKVxuXHRcdFx0XHQpXG5cdFx0XHRcdC50b1N0cmluZygpO1xuXHRcdFx0Y29uc3QgY29tcGlsZXIgPSBoYW5kbGViYXJzLmNvbXBpbGUoc291cmNlKTtcblx0XHRcdGZzLndyaXRlRmlsZVN5bmModGhpcy5zZXJ2ZXJDb25maWdQYXRoLCBjb21waWxlcihjb250ZXh0KSk7XG5cdFx0XHRyZXR1cm4gY29udGV4dDtcblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDcmVhdGUgYSBkZWZhdWx0IHByb2R1Y3Rpb24gcmVhZHkgKDkwJSsgZ2xvYmFsIGNvdmVyYWdlKVxuXHQgKiBicm93c2VybGlzdHJjIGZpbGUgZm9yIHlvdXIgcHJvamVjdCBhbmQgYSBwb3N0Y3NzLmNvbmZpZy5qc1xuXHQgKiBmaWxlLlxuXHQgKi9cblx0cHJpdmF0ZSBpbml0U2hhcmVkQ29uZmlnRmlsZXMoKTogdm9pZCB7XG5cdFx0ZnMud3JpdGVGaWxlU3luYyhcblx0XHRcdHBhdGgucmVzb2x2ZSh0aGlzLmN3ZCwgJy5icm93c2Vyc2xpc3RyYycpLFxuXHRcdFx0Jz4gMC4yNSUsIG5vdCBkZWFkJ1xuXHRcdCk7XG5cdFx0ZnMud3JpdGVGaWxlU3luYyhcblx0XHRcdHBhdGgucmVzb2x2ZSh0aGlzLmN3ZCwgJ3Bvc3Rjc3MuY29uZmlnLmpzJyksXG5cdFx0XHRgLyogZXNsaW50LWRpc2FibGUgZ2xvYmFsLXJlcXVpcmUsIGltcG9ydC9uby1leHRyYW5lb3VzLWRlcGVuZGVuY2llcyAqL1xubW9kdWxlLmV4cG9ydHMgPSB7XG5cdC8vIFlvdSBjYW4gYWRkIG1vcmUgcGx1Z2lucyBhbmQgb3RoZXIgcG9zdGNzcyBjb25maWdcblx0Ly8gRm9yIG1vcmUgaW5mbyBzZWVcblx0Ly8gPGh0dHBzOi8vZ2l0aHViLmNvbS9wb3N0Y3NzL3Bvc3Rjc3MtbG9hZGVyI2NvbmZpZ3VyYXRpb24+XG5cdC8vIFRoZXJlIGlzIG5vIG5lZWQgdG8gdXNlIGNzc25hbm8sIHdlYnBhY2sgdGFrZXMgY2FyZSBvZiBpdCFcblx0cGx1Z2luczogW3JlcXVpcmUoJ2F1dG9wcmVmaXhlcicpXSxcbn07XG5gXG5cdFx0KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDb25maWd1cmUgcGFja2FnZS5qc29uIGZpbGUgYW5kIGZpZ3VyZSB3aGljaCBkZXBlbmRlbmNpZXMgdG8gaW5zdGFsbC5cblx0ICovXG5cdHByaXZhdGUgY29uZmlndXJlU2NyaXB0cyhcblx0XHRwcm9qZWN0Q29udGV4dDogUHJvamVjdENvbmZpZ0NvbnRleHRcblx0KTogUHJvamVjdERlcGVuZGVuY2llcyB7XG5cdFx0Y29uc3QgcGFja2FnZUZpbGVEYXRhOiBQa2cgPSB0aGlzLmZpbGVFeGlzdHModGhpcy5wYWNrYWdlSnNvblBhdGgpXG5cdFx0XHQ/IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBnbG9iYWwtcmVxdWlyZVxuXHRcdFx0ICByZXF1aXJlKHRoaXMucGFja2FnZUpzb25QYXRoKVxuXHRcdFx0OiB7XG5cdFx0XHRcdFx0bmFtZTogcHJvamVjdENvbnRleHQuYXBwTmFtZSxcblx0XHRcdCAgfTtcblx0XHQvLyBDaGVjayBpZiBzY3JpcHQgaXMgYWxyZWFkeSBwcmVzZW50XG5cdFx0Y29uc3Qgc2NyaXB0czogeyBbeDogc3RyaW5nXTogc3RyaW5nIH0gPSB7XG5cdFx0XHRidWlsZDogJ3dwYWNraW8tc2NyaXB0cyBidWlsZCcsXG5cdFx0XHRzdGFydDogJ3dwYWNraW8tc2NyaXB0cyBzdGFydCcsXG5cdFx0XHRib290c3RyYXA6ICd3cGFja2lvLXNjcmlwdHMgYm9vdHN0cmFwJyxcblx0XHRcdGFyY2hpdmU6ICd3cGFja2lvLXNjcmlwdHMgcGFjaycsXG5cdFx0fTtcblx0XHRpZiAoIXBhY2thZ2VGaWxlRGF0YS5zY3JpcHRzKSB7XG5cdFx0XHRwYWNrYWdlRmlsZURhdGEuc2NyaXB0cyA9IHt9O1xuXHRcdH1cblx0XHRPYmplY3Qua2V5cyhzY3JpcHRzKS5mb3JFYWNoKHNjcmlwdCA9PiB7XG5cdFx0XHQvLyBUYWtlIGEgYmFja3VwIGlmIHRoZSBzY3JpcHQgaXMgYWxyZWFkeSBkZWZpbmVkXG5cdFx0XHQvLyBhbmQgZG9lc24ndCBlcXVhbCB0byB3aGF0IHdlIHdvdWxkIGxpa2UgaXQgdG8gaGF2ZS5cblx0XHRcdGlmIChcblx0XHRcdFx0cGFja2FnZUZpbGVEYXRhLnNjcmlwdHMgJiZcblx0XHRcdFx0cGFja2FnZUZpbGVEYXRhLnNjcmlwdHNbc2NyaXB0XSAhPSBudWxsICYmXG5cdFx0XHRcdHBhY2thZ2VGaWxlRGF0YS5zY3JpcHRzW3NjcmlwdF0gIT09IHNjcmlwdHNbc2NyaXB0XVxuXHRcdFx0KSB7XG5cdFx0XHRcdHBhY2thZ2VGaWxlRGF0YS5zY3JpcHRzW2Ake3NjcmlwdH0tYmFja3VwYF0gPVxuXHRcdFx0XHRcdHBhY2thZ2VGaWxlRGF0YS5zY3JpcHRzW3NjcmlwdF07XG5cdFx0XHRcdHBhY2thZ2VGaWxlRGF0YS5zY3JpcHRzW3NjcmlwdF0gPSBzY3JpcHRzW3NjcmlwdF07XG5cdFx0XHR9IGVsc2UgaWYgKHBhY2thZ2VGaWxlRGF0YS5zY3JpcHRzKSB7XG5cdFx0XHRcdC8vIE90aGVyd2lzZSBkZWZpbmUgb3VyIG93blxuXHRcdFx0XHRwYWNrYWdlRmlsZURhdGEuc2NyaXB0c1tzY3JpcHRdID0gc2NyaXB0c1tzY3JpcHRdO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0Ly8gV3JpdGUgaXRcblx0XHRmcy53cml0ZUZpbGVTeW5jKFxuXHRcdFx0dGhpcy5wYWNrYWdlSnNvblBhdGgsXG5cdFx0XHRKU09OLnN0cmluZ2lmeShwYWNrYWdlRmlsZURhdGEsIG51bGwsIDIpXG5cdFx0KTtcblxuXHRcdC8vIFJldHVybiBkZXBlbmRlbmNpZXNcblx0XHRyZXR1cm4gdGhpcy5nZXREZXBlbmRlbmNpZXMocHJvamVjdENvbnRleHQpO1xuXHR9XG5cblx0cHJpdmF0ZSBnZXREZXBlbmRlbmNpZXMocHJvamVjdENvbnRleHQ6IFByb2plY3RDb25maWdDb250ZXh0KSB7XG5cdFx0Y29uc3QgcGFja2FnZUZpbGVEYXRhOiBQa2cgPSB0aGlzLmZpbGVFeGlzdHModGhpcy5wYWNrYWdlSnNvblBhdGgpXG5cdFx0XHQ/IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBnbG9iYWwtcmVxdWlyZVxuXHRcdFx0ICByZXF1aXJlKHRoaXMucGFja2FnZUpzb25QYXRoKVxuXHRcdFx0OiB7XG5cdFx0XHRcdFx0bmFtZTogcHJvamVjdENvbnRleHQuYXBwTmFtZSxcblx0XHRcdCAgfTtcblx0XHQvLyBBZGQgZGVwZW5kZW5jaWVzIG9mIEB3cGFja2lvL2VudHJ5cG9pbnQgYW5kIEB3cGFja2lvL3NjcmlwdHMgaWYgbmVlZGVkXG5cdFx0Y29uc3QgZGVwZW5kZW5jaWVzOiBzdHJpbmdbXSA9IFsnQHdwYWNraW8vZW50cnlwb2ludCddO1xuXHRcdGNvbnN0IGRldkRlcGVuZGVuY2llczogc3RyaW5nW10gPSBbXTtcblxuXHRcdC8vIElmIEB3cGFja2lvL3NjcmlwdHMgaXMgbm90IGFscmVhZHkgcHJlc2VudCBpbiBkZXZEZXBlbmRlbmNpZXNcblx0XHQvLyBUaGVuIHB1c2ggaXQuIFdlIGRvIHRoaXMgY2hlY2ssIGJlY2F1c2UgQHdwYWNraW8vY2xpIG1pZ2h0IGFscmVhZHlcblx0XHQvLyBoYXZlIGluc3RhbGxlZCBpdCBkdXJpbmcgc2NhZmZvbGRpbmcuXG5cdFx0aWYgKFxuXHRcdFx0IXBhY2thZ2VGaWxlRGF0YS5kZXZEZXBlbmRlbmNpZXMgfHxcblx0XHRcdCFwYWNrYWdlRmlsZURhdGEuZGV2RGVwZW5kZW5jaWVzWydAd3BhY2tpby9zY3JpcHRzJ11cblx0XHQpIHtcblx0XHRcdGRldkRlcGVuZGVuY2llcy5wdXNoKCdAd3BhY2tpby9zY3JpcHRzJyk7XG5cdFx0fVxuXHRcdC8vIElmIGhhcyBTYXNzLCB0aGVuIHB1c2ggc2FzcyAoZGFydCBzYXNzKVxuXHRcdGlmIChwcm9qZWN0Q29udGV4dC5oYXNTYXNzID09PSAndHJ1ZScpIHtcblx0XHRcdGRldkRlcGVuZGVuY2llcy5wdXNoKCdzYXNzJyk7XG5cdFx0fVxuXHRcdC8vIGlmIGhhcyBMZXNzLCB0aGVuIHB1c2ggbGVzc1xuXHRcdGlmIChwcm9qZWN0Q29udGV4dC5oYXNMZXNzID09PSAndHJ1ZScpIHtcblx0XHRcdGRldkRlcGVuZGVuY2llcy5wdXNoKCdsZXNzJyk7XG5cdFx0fVxuXHRcdC8vIGlmIGhhcyB0cywgdGhlbiBwdXNoIGZvcmstdHMtY2hlY2tlci13ZWJwYWNrLXBsdWdpblxuXHRcdGlmIChwcm9qZWN0Q29udGV4dC5oYXNUUyA9PT0gJ3RydWUnKSB7XG5cdFx0XHRkZXZEZXBlbmRlbmNpZXMucHVzaCgndHlwZXNjcmlwdCcpO1xuXHRcdFx0ZGV2RGVwZW5kZW5jaWVzLnB1c2goJ2ZvcmstdHMtY2hlY2tlci13ZWJwYWNrLXBsdWdpbicpO1xuXHRcdH1cblxuXHRcdC8vIGFsd2F5cyBwdXNoIHBvc3Rjc3MsIHN0YXJ0aW5nIHZlcnNpb24gNi4wXG5cdFx0ZGV2RGVwZW5kZW5jaWVzLnB1c2goJ3Bvc3Rjc3MnKTtcblxuXHRcdHJldHVybiB7IGRlcGVuZGVuY2llcywgZGV2RGVwZW5kZW5jaWVzIH07XG5cdH1cblxuXHRwcml2YXRlIGlzQ29uZmlnUHJlc2VudCh0eXBlOiAncHJvamVjdCcgfCAnc2VydmVyJyk6IGJvb2xlYW4ge1xuXHRcdGNvbnN0IGZpbGVQYXRoID1cblx0XHRcdHR5cGUgPT09ICdwcm9qZWN0JyA/IHRoaXMucHJvamVjdENvbmZpZ1BhdGggOiB0aGlzLnNlcnZlckNvbmZpZ1BhdGg7XG5cdFx0cmV0dXJuIHRoaXMuZmlsZUV4aXN0cyhmaWxlUGF0aCk7XG5cdH1cblxuXHRwcml2YXRlIGZpbGVFeGlzdHMoZmlsZVBhdGg6IHN0cmluZyk6IGJvb2xlYW4ge1xuXHRcdHRyeSB7XG5cdFx0XHRyZXR1cm4gZnMuc3RhdFN5bmMoZmlsZVBhdGgpLmlzRmlsZSgpO1xuXHRcdH0gY2F0Y2ggKGUpIHtcblx0XHRcdGlmIChlLmNvZGUgPT09ICdFTk9FTlQnKSB7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblx0XHRcdHRocm93IGU7XG5cdFx0fVxuXHR9XG59XG4iXX0=